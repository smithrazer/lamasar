<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lum‚ÄôAsar Web GUI v2.3</n  
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; color: #333; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    h1 { text-align: center; color: #4a90e2; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; }
    .controls > div { flex: 1 1 200px; }
    .syllables, .markers { background: #fff; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { display: block; margin-bottom: 5px; cursor: pointer; }
    button { background: #4caf50; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; }
    button:hover { background: #43a047; }
    #output { background: #fff; padding: 10px; border-radius: 8px; min-height: 100px; margin-top: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    canvas { background: #fff; border: 1px solid #ccc; margin-top: 10px; }
    input[type=file] { margin-bottom: 10px; }
    img { max-width: 300px; display: block; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Lum‚ÄôAsar Web GUI v2.3</h1>

    <input type="file" id="imgInput" accept="image/*">
    <img id="preview" src="" alt="Preview">

    <div class="controls">
      <div class="syllables">
        <h3>–°–ª–æ–≥–∏ (–¥–æ 4)</h3>
        <div id="syllables"></div>
      </div>
      <div class="markers">
        <h3>–ì—Ä–∞–º–º. –º–∞—Ä–∫–µ—Ä</h3>
        <div id="markers"></div>
      </div>
    </div>

    <div style="margin-top:10px;">
      <label>–°–¥–≤–∏–≥ —á–∞—Å—Ç–æ—Ç—ã: <span id="shiftVal">0</span> –ì—Ü</label>
      <input type="range" id="shift" min="-20" max="20" value="0">
    </div>

    <button id="generate">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞–Ω—Ç—Ä—É</button>

    <div id="output"></div>
    <canvas id="canvas" width="300" height="300"></canvas>
  </div>

  <script>
    // Dictionaries
    const LUM_ASAR = {
      Lu:{freq:432, figure:'spiral', color:'#FFD700'}, Sa:{freq:528, figure:'line', color:'#FF69B4'},
      Ra:{freq:639, figure:'triangle', color:'#FF4500'}, Va:{freq:741, figure:'circle', color:'#32CD32'},
      Mi:{freq:852, figure:'circle_filled', color:'#1E90FF'}, Ke:{freq:963, figure:'dot', color:'#000000'},
      Nu:{freq:684, figure:'square', color:'#8B4513'}, Mu:{freq:720, figure:'ellipse', color:'#008080'},
      Fi:{freq:396, figure:'flame', color:'#FF4500'}, Wa:{freq:417, figure:'wave_water', color:'#1E90FF'},
      Ai:{freq:471, figure:'wind', color:'#A9A9A9'}, Ea:{freq:333, figure:'grid', color:'#8B4513'},
      Is:{freq:396, figure:'drop', color:'#8B4513'}, Za:{freq:417, figure:'spiral', color:'#FF69B4'},
      Zi:{freq:528, figure:'wave', color:'#FF4500'}, Pe:{freq:639, figure:'circle', color:'#FFD700'},
      La:{freq:741, figure:'triangle', color:'#32CD32'}, Le:{freq:852, figure:'circle_filled', color:'#1E90FF'},
      Us:{freq:963, figure:'line', color:'#00008B'}, Ch:{freq:1080, figure:'harmony', color:'#4B0082'},
      Ro:{freq:1152, figure:'square', color:'#800080'}
    };
    const GR_MARKERS = { ka:{desc:'–∏—Å—Ü–µ–ª—è—é—â–∞—è', symbol:'üîÜ'}, ta:{desc:'–∞–∫—Ç–∏–≤–∏—Ä—É—é—â–∞—è', symbol:'‚ö°'}, na:{desc:'–º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–∞—è', symbol:'üßò'} };

    let selected = [], marker = '';
    const sylDiv = document.getElementById('syllables'), markDiv = document.getElementById('markers');
    const shift = document.getElementById('shift'), shiftVal = document.getElementById('shiftVal');
    const out = document.getElementById('output'), can = document.getElementById('canvas'), ctx = can.getContext('2d');

    // Build inputs
    Object.keys(LUM_ASAR).forEach(s=>{
      let cb = document.createElement('input'), lbl = document.createElement('label');
      cb.type='checkbox'; cb.value=s; cb.onchange=()=>{
        if(cb.checked) { if(selected.length<4) selected.push(s); else cb.checked=false; }
        else selected = selected.filter(x=>x!==s);
        showCurrent();
      };
      lbl.textContent=s; lbl.prepend(cb); sylDiv.append(lbl);
    });
    Object.keys(GR_MARKERS).forEach(m=>{
      let rb = document.createElement('input'), lbl = document.createElement('label');
      rb.type='radio'; rb.name='marker'; rb.value=m; rb.onchange=()=>{ marker=m; showCurrent(); };
      lbl.textContent=m; lbl.prepend(rb); markDiv.append(lbl);
    });

    shift.oninput = ()=>{ shiftVal.textContent=shift.value; };

    function showCurrent(){ out.textContent=`–°–ª–æ–≥–∏: ${selected.join(', ')}  –ú–∞—Ä–∫–µ—Ä: ${marker}`; }

    function generate(){
      if(!selected.length){ out.textContent='–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≥–∏!'; return; }
      let freqs=selected.map(s=>LUM_ASAR[s].freq+parseInt(shift.value)), avg=freqs.reduce((a,b)=>a+b)/freqs.length;
      let form=selected.join('-')+(marker?'-'+marker:'');
      let desc=selected.map(s=>LUM_ASAR[s].figure).join(', ')+(marker? ', '+GR_MARKERS[marker].desc:'');
      let syms=selected.map(s=>LUM_ASAR[s].symbol).join('')+(marker?GR_MARKERS[marker].symbol:'');
      out.innerHTML=`<p>–§–æ—Ä–º—É–ª–∞: ${form}</p><p>–ß–∞—Å—Ç–æ—Ç—ã: [${freqs.join(', ')}]</p>`+
        `<p>–°—Ä–µ–¥–Ω—è—è: ${avg.toFixed(1)} –ì—Ü</p><p>–°–∏–º–≤–æ–ª—ã: ${syms}</p>`;
      playTone(avg);
      draw();
    }

    document.getElementById('generate').onclick = generate;

    // Image preview
    document.getElementById('imgInput').onchange = e=>{
      const file = e.target.files[0]; if(!file) return;
      const url = URL.createObjectURL(file); document.getElementById('preview').src=url;
    };

    // Audio
    function playTone(freq){
      if(!window.AudioContext) return;
      const ac=new AudioContext(); const osc=ac.createOscillator(), gain=ac.createGain();
      osc.frequency.value = freq; osc.connect(gain); gain.connect(ac.destination);
      osc.start(); gain.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+0.8);
      setTimeout(()=>{ osc.stop(); ac.close(); },800);
    }

    // Drawing
    function draw(){
      ctx.clearRect(0,0,300,300);
      ctx.strokeStyle='orange'; ctx.strokeRect(10,10,50,30);
      let x=150,y=150,r=40;
      selected.forEach((s,i)=>{
        let fig=LUM_ASAR[s].figure, col=LUM_ASAR[s].color, off=i*30;
        ctx.strokeStyle=col;
        ctx.beginPath();
        switch(fig){
          case 'spiral': ctx.ellipse(x,y,r+off,r+off,0,0,Math.PI*2); break;
          case 'line': ctx.moveTo(x-50,y+off); ctx.lineTo(x+50,y+off); break;
          case 'triangle': ctx.moveTo(x,y-r-off); ctx.lineTo(x-r,y+r-off); ctx.lineTo(x+r,y+r-off); ctx.closePath(); break;
          case 'circle': ctx.arc(x,y,r+off,0,Math.PI*2); break;
          case 'circle_filled': ctx.arc(x,y,r+off,0,Math.PI*2); ctx.fillStyle=col; ctx.fill(); break;
          case 'dot': ctx.arc(x,y-off,3,0,Math.PI*2); ctx.fillStyle=col; ctx.fill(); break;
          case 'square': ctx.rect(x-r-off,y-r-off,2*(r+off),2*(r+off)); break;
          case 'ellipse': ctx.ellipse(x,y,r+off*1.5,r+off,0,0,Math.PI*2); break;
          case 'flame': ctx.moveTo(x,y-r-off); ctx.lineTo(x-r/2-off,y+off); ctx.lineTo(x,y-r/2-off); ctx.lineTo(x+r/2+off,y+off); ctx.closePath(); break;
          case 'wave_water': for(let dx=-50,pts=[];dx<=50;dx+=5){ pts.push({x:x+dx,y:y+off+10*Math.sin(dx*0.2)}); } pts.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y)); break;
          case 'wind': ctx.arc(x,y,r+off,0,Math.PI*0.8); break;
          case 'grid': let size=r+off,step=size/3; for(let j=-size;j<=size;j+=step){ ctx.moveTo(x+j,y-size); ctx.lineTo(x+j,y+size); ctx.moveTo(x-size,y+j); ctx.lineTo(x+size,y+j); } break;
          case 'drop': ctx.moveTo(x,y-r-off); ctx.quadraticCurveTo(x-r/2,y, x,y+r-off); ctx.quadraticCurveTo(x+r/2,y,x,y-r-off); break;
          case 'harmony': ctx.arc(x,y,r+off,0,Math.PI); ctx.moveTo(x-r-off,y); ctx.lineTo(x+r+off,y); break;
        }
        ctx.stroke();
      });
    }
  </script>
</body>
</html>
